{"repository":"biojava","prod_path":"biojava-core/src/main/java/org/biojava3/core/sequence/io/FastaWriter.java","test_path":"biojava-core/src/test/java/org/biojava3/core/sequence/io/FastaWriterTest.java","prod_time":"2015-01-30 06:34:57","test_time":"2015-01-30 06:34:57","type":"EDIT","proType":"EDIT","add_annotation_line":0,"add_call_line":0,"add_classname_line":0,"add_condition_line":0,"add_field_line":0,"add_import_line":6,"add_packageid_line":0,"add_parameter_line":0,"add_return_line":0,"del_annotation_line":0,"del_call_line":0,"del_classname_line":0,"del_condition_line":0,"del_field_line":0,"del_import_line":6,"del_packageid_line":0,"del_parameter_line":0,"del_return_line":0,"label":"POSITIVE","prod_commitID":"ac224492a348dfb69e069ccff4ae03b0c5d2087c","test_commitID":"ac224492a348dfb69e069ccff4ae03b0c5d2087c","isfound":"found test change","originPro":"/*\n *                    BioJava development code\n *\n * This code may be freely distributed and modified under the\n * terms of the GNU Lesser General Public Licence.  This should\n * be distributed with the code.  If you do not have a copy,\n * see:\n *\n *      http://www.gnu.org/copyleft/lesser.html\n *\n * Copyright for this code is held jointly by the individual\n * authors.  These should be listed in @author doc comments.\n *\n * For more information on the BioJava project and its aims,\n * or to join the biojava-l mailing list, visit the home page\n * at:\n *\n *      http://www.biojava.org/\n *\n * Created on 01-21-2010\n */\npackage org.biojava3.core.sequence.io;\n\nimport java.io.BufferedOutputStream;\nimport java.io.FileInputStream;\nimport java.io.FileOutputStream;\nimport java.io.OutputStream;\nimport java.util.Collection;\nimport java.util.LinkedHashMap;\n\nimport org.biojava3.core.sequence.ProteinSequence;\nimport org.biojava3.core.sequence.compound.AminoAcidCompound;\nimport org.biojava3.core.sequence.compound.AminoAcidCompoundSet;\nimport org.biojava3.core.sequence.io.template.FastaHeaderFormatInterface;\nimport org.biojava3.core.sequence.template.Compound;\nimport org.biojava3.core.sequence.template.Sequence;\nimport org.slf4j.Logger;\nimport org.slf4j.LoggerFactory;\n\n/**\n * The FastaWriter writes a collection of sequences to an outputStream. FastaWriterHelper should be\n * used to write out sequences. Each sequence loaded from a fasta file retains the original Fasta header\n * and that is used when writing to the stream. This behavior can be overwritten by implementing\n * a custom FastaHeaderFormatInterface.\n *\n * @author Scooter Willis <willishf at gmail dot com>\n */\npublic class FastaWriter<S extends Sequence<?>, C extends Compound> {\n\n\tprivate final static Logger logger = LoggerFactory.getLogger(FastaWriter.class);\n\n    OutputStream os;\n    Collection<S> sequences;\n    FastaHeaderFormatInterface<S, C> headerFormat;\n    private int lineLength = 60;\n    byte[] lineSep = System.getProperty(\"line.separator\").getBytes();\n/**\n * Use default line length of 60\n * @param os\n * @param sequences\n * @param headerFormat\n */\n    public FastaWriter(OutputStream os, Collection<S> sequences, FastaHeaderFormatInterface<S, C> headerFormat) {\n\n        this.os = os;\n        this.sequences = sequences;\n        this.headerFormat = headerFormat;\n    }\n\n/**\n * Set custom lineLength\n * @param os\n * @param sequences\n * @param headerFormat\n * @param lineLength\n */\n\n    public FastaWriter(OutputStream os, Collection<S> sequences, FastaHeaderFormatInterface<S, C> headerFormat, int lineLength) {\n        this.os = os;\n        this.sequences = sequences;\n        this.headerFormat = headerFormat;\n        this.lineLength = lineLength;\n    }\n\n    /**\n     * Allow an override of operating system line separator for programs that needs a specific CRLF or CR or LF option\n     * @param lineSeparator\n     */\n    public void setLineSeparator(String lineSeparator){\n        lineSep = lineSeparator.getBytes();\n    }\n\n    public void process() throws Exception {\n       // boolean closeit = false;\n       \n        \n\n        for (S sequence : sequences) {\n            String header = headerFormat.getHeader(sequence);\n            os.write('>');\n            os.write(header.getBytes());\n            os.write(lineSep);\n\n            int compoundCount = 0;\n            String seq = \"\";\n\n            seq = sequence.getSequenceAsString();\n\n            for (int i = 0; i < seq.length(); i++) {\n                os.write(seq.charAt(i));\n                compoundCount++;\n                if (compoundCount == lineLength) {\n                    os.write(lineSep);\n                    compoundCount = 0;\n                }\n\n            }\n\n\n            //If we had sequence which was a reciprocal of line length\n            //then don't write the line terminator as this has already written\n            //it\n            if ((sequence.getLength() % getLineLength()) != 0) {\n                os.write(lineSep);\n            }\n        }\n        \n    }\n\n    public static void main(String[] args) {\n        try {\n            FileInputStream is = new FileInputStream(\"/Users/Scooter/scripps/dyadic/c1-454Scaffolds.faa\");\n\n\n            FastaReader<ProteinSequence, AminoAcidCompound> fastaReader = new FastaReader<ProteinSequence, AminoAcidCompound>(is, new GenericFastaHeaderParser<ProteinSequence, AminoAcidCompound>(), new ProteinSequenceCreator(AminoAcidCompoundSet.getAminoAcidCompoundSet()));\n            LinkedHashMap<String, ProteinSequence> proteinSequences = fastaReader.process();\n            is.close();\n\n\n          //  logger.debug(proteinSequences);\n\n            FileOutputStream fileOutputStream = new FileOutputStream(\"/Users/Scooter/scripps/dyadic/c1-454Scaffolds_temp.faa\");\n           \n            BufferedOutputStream bo = new BufferedOutputStream(fileOutputStream);\n            long start = System.currentTimeMillis();\n            FastaWriter<ProteinSequence, AminoAcidCompound> fastaWriter = new FastaWriter<ProteinSequence, AminoAcidCompound>(bo, proteinSequences.values(), new GenericFastaHeaderFormat<ProteinSequence, AminoAcidCompound>());\n            fastaWriter.process();\n            bo.close();\n            long end = System.currentTimeMillis();\n            logger.info(\"Took {} seconds\", (end - start));\n         \n            fileOutputStream.close();\n\n\n        } catch (Exception e) {\n            logger.warn(\"Exception: \", e);\n        }\n    }\n\n    /**\n     * @return the lineLength\n     */\n    public int getLineLength() {\n        return lineLength;\n    }\n\n    /**\n     * @param lineLength the lineLength to set\n     */\n    public void setLineLength(int lineLength) {\n        this.lineLength = lineLength;\n    }\n}\n","changedPro":"/*\n *                    BioJava development code\n *\n * This code may be freely distributed and modified under the\n * terms of the GNU Lesser General Public Licence.  This should\n * be distributed with the code.  If you do not have a copy,\n * see:\n *\n *      http://www.gnu.org/copyleft/lesser.html\n *\n * Copyright for this code is held jointly by the individual\n * authors.  These should be listed in @author doc comments.\n *\n * For more information on the BioJava project and its aims,\n * or to join the biojava-l mailing list, visit the home page\n * at:\n *\n *      http://www.biojava.org/\n *\n * Created on 01-21-2010\n */\npackage org.biojava3.core.sequence.io;\n\nimport org.biojava3.core.sequence.ProteinSequence;\nimport org.biojava3.core.sequence.compound.AminoAcidCompound;\nimport org.biojava3.core.sequence.compound.AminoAcidCompoundSet;\nimport org.biojava3.core.sequence.io.template.FastaHeaderFormatInterface;\nimport org.biojava3.core.sequence.template.Compound;\nimport org.biojava3.core.sequence.template.Sequence;\nimport org.slf4j.Logger;\nimport org.slf4j.LoggerFactory;\n\nimport java.io.BufferedOutputStream;\nimport java.io.FileInputStream;\nimport java.io.FileOutputStream;\nimport java.io.OutputStream;\nimport java.util.Collection;\nimport java.util.LinkedHashMap;\n\n/**\n * The FastaWriter writes a collection of sequences to an outputStream. FastaWriterHelper should be\n * used to write out sequences. Each sequence loaded from a fasta file retains the original Fasta header\n * and that is used when writing to the stream. This behavior can be overwritten by implementing\n * a custom FastaHeaderFormatInterface.\n *\n * @author Scooter Willis <willishf at gmail dot com>\n */\npublic class FastaWriter<S extends Sequence<?>, C extends Compound> {\n\n\tprivate final static Logger logger = LoggerFactory.getLogger(FastaWriter.class);\n\n    OutputStream os;\n    Collection<S> sequences;\n    FastaHeaderFormatInterface<S, C> headerFormat;\n    private int lineLength = 60;\n    byte[] lineSep = System.getProperty(\"line.separator\").getBytes();\n/**\n * Use default line length of 60\n * @param os\n * @param sequences\n * @param headerFormat\n */\n    public FastaWriter(OutputStream os, Collection<S> sequences, FastaHeaderFormatInterface<S, C> headerFormat) {\n\n        this.os = os;\n        this.sequences = sequences;\n        this.headerFormat = headerFormat;\n    }\n\n/**\n * Set custom lineLength\n * @param os\n * @param sequences\n * @param headerFormat\n * @param lineLength\n */\n\n    public FastaWriter(OutputStream os, Collection<S> sequences, FastaHeaderFormatInterface<S, C> headerFormat, int lineLength) {\n        this.os = os;\n        this.sequences = sequences;\n        this.headerFormat = headerFormat;\n        this.lineLength = lineLength;\n    }\n\n    /**\n     * Allow an override of operating system line separator for programs that needs a specific CRLF or CR or LF option\n     * @param lineSeparator\n     */\n    public void setLineSeparator(String lineSeparator){\n        lineSep = lineSeparator.getBytes();\n    }\n\n    public void process() throws Exception {\n       // boolean closeit = false;\n       \n        \n\n        for (S sequence : sequences) {\n            String header = headerFormat.getHeader(sequence);\n            os.write('>');\n            os.write(header.getBytes());\n            os.write(lineSep);\n\n            int compoundCount = 0;\n            String seq = \"\";\n\n            seq = sequence.getSequenceAsString();\n\n            for (int i = 0; i < seq.length(); i++) {\n                os.write(seq.charAt(i));\n                compoundCount++;\n                if (compoundCount == lineLength) {\n                    os.write(lineSep);\n                    compoundCount = 0;\n                }\n\n            }\n\n\n            //If we had sequence which was a reciprocal of line length\n            //then don't write the line terminator as this has already written\n            //it\n            if ((sequence.getLength() % getLineLength()) != 0) {\n                os.write(lineSep);\n            }\n        }\n        \n    }\n\n    public static void main(String[] args) {\n        try {\n            FileInputStream is = new FileInputStream(\"/Users/Scooter/scripps/dyadic/c1-454Scaffolds.faa\");\n\n\n            FastaReader<ProteinSequence, AminoAcidCompound> fastaReader = new FastaReader<ProteinSequence, AminoAcidCompound>(is, new GenericFastaHeaderParser<ProteinSequence, AminoAcidCompound>(), new ProteinSequenceCreator(AminoAcidCompoundSet.getAminoAcidCompoundSet()));\n            LinkedHashMap<String, ProteinSequence> proteinSequences = fastaReader.process();\n            is.close();\n\n\n          //  logger.debug(proteinSequences);\n\n            FileOutputStream fileOutputStream = new FileOutputStream(\"/Users/Scooter/scripps/dyadic/c1-454Scaffolds_temp.faa\");\n           \n            BufferedOutputStream bo = new BufferedOutputStream(fileOutputStream);\n            long start = System.currentTimeMillis();\n            FastaWriter<ProteinSequence, AminoAcidCompound> fastaWriter = new FastaWriter<ProteinSequence, AminoAcidCompound>(bo, proteinSequences.values(), new GenericFastaHeaderFormat<ProteinSequence, AminoAcidCompound>());\n            fastaWriter.process();\n            bo.close();\n            long end = System.currentTimeMillis();\n            logger.info(\"Took {} seconds\", (end - start));\n         \n            fileOutputStream.close();\n\n\n        } catch (Exception e) {\n            logger.warn(\"Exception: \", e);\n        }\n    }\n\n    /**\n     * @return the lineLength\n     */\n    public int getLineLength() {\n        return lineLength;\n    }\n\n    /**\n     * @param lineLength the lineLength to set\n     */\n    public void setLineLength(int lineLength) {\n        this.lineLength = lineLength;\n    }\n}\n","originTest":"/*\n *                    BioJava development code\n *\n * This code may be freely distributed and modified under the\n * terms of the GNU Lesser General Public Licence.  This should\n * be distributed with the code.  If you do not have a copy,\n * see:\n *\n *      http://www.gnu.org/copyleft/lesser.html\n *\n * Copyright for this code is held jointly by the individual\n * authors.  These should be listed in @author doc comments.\n *\n * For more information on the BioJava project and its aims,\n * or to join the biojava-l mailing list, visit the home page\n * at:\n *\n *      http://www.biojava.org/\n *\n */\npackage org.biojava3.core.sequence.io;\n\n\nimport static org.hamcrest.CoreMatchers.is;\nimport static org.junit.Assert.assertThat;\n\nimport java.io.ByteArrayOutputStream;\n\nimport org.biojava3.core.sequence.AccessionID;\nimport org.biojava3.core.sequence.DNASequence;\nimport org.junit.Test;\n\npublic class FastaWriterTest {\n\n  @Test\n  public void writeBasicFasta() throws Exception {\n    String id         = \"Example\";\n    String dnaLineOne = \"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\";\n    String dnaLineTwo = \"T\";\n\n    DNASequence s = new DNASequence(dnaLineOne+dnaLineTwo);\n    s.setAccession(new AccessionID(id));\n    ByteArrayOutputStream baos = new ByteArrayOutputStream();\n    FastaWriterHelper.writeSequence(baos, s);\n\n    String actual = new String(baos.toByteArray());\n    String expected = String.format(\">%s%n%s%n%s%n\", id, dnaLineOne, dnaLineTwo);\n\n    assertThat(\"Writer not as expected\", actual, is(expected));\n  }\n\n  @Test\n  public void writeFastaEqualToLineLength() throws Exception {\n    String id  = \"Example\";\n    String dna = \"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAT\";\n\n    DNASequence s = new DNASequence(dna);\n    s.setAccession(new AccessionID(id));\n    ByteArrayOutputStream baos = new ByteArrayOutputStream();\n    FastaWriterHelper.writeSequence(baos, s);\n\n    String actual = new String(baos.toByteArray());\n    String expected = String.format(\">%s%n%s%n\", id, dna);\n\n    assertThat(\"Writer not as expected\", actual, is(expected));\n  }\n\n}\n","changedTest":"/*\n *                    BioJava development code\n *\n * This code may be freely distributed and modified under the\n * terms of the GNU Lesser General Public Licence.  This should\n * be distributed with the code.  If you do not have a copy,\n * see:\n *\n *      http://www.gnu.org/copyleft/lesser.html\n *\n * Copyright for this code is held jointly by the individual\n * authors.  These should be listed in @author doc comments.\n *\n * For more information on the BioJava project and its aims,\n * or to join the biojava-l mailing list, visit the home page\n * at:\n *\n *      http://www.biojava.org/\n *\n */\npackage org.biojava3.core.sequence.io;\n\n\nimport org.biojava3.core.sequence.AccessionID;\nimport org.biojava3.core.sequence.DNASequence;\nimport org.junit.Test;\n\nimport java.io.ByteArrayOutputStream;\n\nimport static org.hamcrest.CoreMatchers.is;\nimport static org.junit.Assert.assertThat;\n\npublic class FastaWriterTest {\n\n  @Test\n  public void writeBasicFasta() throws Exception {\n    String id         = \"Example\";\n    String dnaLineOne = \"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\";\n    String dnaLineTwo = \"T\";\n\n    DNASequence s = new DNASequence(dnaLineOne+dnaLineTwo);\n    s.setAccession(new AccessionID(id));\n    ByteArrayOutputStream baos = new ByteArrayOutputStream();\n    FastaWriterHelper.writeSequence(baos, s);\n\n    String actual = new String(baos.toByteArray());\n    String expected = String.format(\">%s%n%s%n%s%n\", id, dnaLineOne, dnaLineTwo);\n\n    assertThat(\"Writer not as expected\", actual, is(expected));\n  }\n\n  @Test\n  public void writeFastaEqualToLineLength() throws Exception {\n    String id  = \"Example\";\n    String dna = \"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAT\";\n\n    DNASequence s = new DNASequence(dna);\n    s.setAccession(new AccessionID(id));\n    ByteArrayOutputStream baos = new ByteArrayOutputStream();\n    FastaWriterHelper.writeSequence(baos, s);\n\n    String actual = new String(baos.toByteArray());\n    String expected = String.format(\">%s%n%s%n\", id, dna);\n\n    assertThat(\"Writer not as expected\", actual, is(expected));\n  }\n\n}\n","commitMessage":"Ran Optimize Imports across the whole project.\n","test_commitMessage":"Ran Optimize Imports across the whole project.\n","allZero":false}