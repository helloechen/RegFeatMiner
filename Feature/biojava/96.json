{"repository":"biojava","prod_path":"biojava3-core/src/main/java/org/biojava3/core/sequence/io/CasePreservingProteinSequenceCreator.java","test_path":"biojava3-core/src/test/java/org/biojava3/core/sequence/io/CasePreservingProteinSequenceCreatorTest.java","prod_time":"2014-10-28 22:37:56","test_time":"2014-10-28 22:37:56","type":"EDIT","proType":"EDIT","add_annotation_line":0,"add_call_line":0,"add_classname_line":0,"add_condition_line":0,"add_field_line":0,"add_import_line":1,"add_packageid_line":0,"add_parameter_line":2,"add_return_line":0,"del_annotation_line":0,"del_call_line":0,"del_classname_line":0,"del_condition_line":0,"del_field_line":0,"del_import_line":0,"del_packageid_line":0,"del_parameter_line":2,"del_return_line":0,"label":"POSITIVE","prod_commitID":"a0af04547e876ec285d75dc84f9c68d06d21e797","test_commitID":"a0af04547e876ec285d75dc84f9c68d06d21e797","isfound":"found test change","originPro":"package org.biojava3.core.sequence.io;\n\nimport java.util.ArrayList;\nimport java.util.Collection;\nimport java.util.List;\nimport java.util.Locale;\n\nimport org.biojava3.core.sequence.ProteinSequence;\nimport org.biojava3.core.sequence.compound.AminoAcidCompound;\nimport org.biojava3.core.sequence.compound.AminoAcidCompoundSet;\nimport org.biojava3.core.sequence.template.AbstractSequence;\nimport org.biojava3.core.sequence.template.CompoundSet;\nimport org.biojava3.core.sequence.template.ProxySequenceReader;\n\nimport org.slf4j.Logger;\nimport org.slf4j.LoggerFactory;\n\n/**\n * A sequence creator which preserves the case of its input string in\n * the user collection of the returned ProteinSequence.\n * \n * <p>The user collection will be the same length as the resulting ProteinSequence.\n * Each object can be cast to a Boolean. If true, the corresponding position in\n * the input file was uppercase.\n * \n * <h3>Example</h3>\n * <code><pre>CasePreservingProteinSequenceCreator creator =\n *    new CasePreservingProteinSequenceCreator(AminoAcidCompoundSet.getAminoAcidCompoundSet());\n *AbstractSequence<AminoAcidCompound> seq = creator.getSequence(\"aaAA\",0);\n *System.out.println(seq.getSequenceAsString()); //\"AAAA\"\n *System.out.println(seq.getUserCollection()); //\"[false, false, true, true]\"\n *</code></pre>\n */\npublic class CasePreservingProteinSequenceCreator extends ProteinSequenceCreator {\n\n\tprivate final static Logger logger = LoggerFactory.getLogger(CasePreservingProteinSequenceCreator.class);\n\n\tpublic CasePreservingProteinSequenceCreator(\n\t\t\tCompoundSet<AminoAcidCompound> compoundSet) {\n\t\tsuper(compoundSet);\n\t}\n\n\t/**\n\t * \n\t * @see org.biojava3.core.sequence.io.ProteinSequenceCreator#getSequence(org.biojava3.core.sequence.template.ProxySequenceReader, long)\n\t */\n\t@Override\n\tpublic AbstractSequence<AminoAcidCompound> getSequence(\n\t\t\tProxySequenceReader<AminoAcidCompound> proxyLoader, long index) {\n\t\tAbstractSequence<AminoAcidCompound> seq = super.getSequence(proxyLoader, index);\n\t\tseq.setUserCollection(getStringCase(proxyLoader.getSequenceAsString()));\n\t\treturn seq;\n\t}\n\n\t/* (non-Javadoc)\n\t * @see org.biojava3.core.sequence.io.ProteinSequenceCreator#getSequence(java.lang.String, long)\n\t */\n\t@Override\n\tpublic AbstractSequence<AminoAcidCompound> getSequence(String sequence,\n\t\t\tlong index) {\n\t\tAbstractSequence<AminoAcidCompound> seq = super.getSequence(sequence.toUpperCase(Locale.ENGLISH), index);\n\t\tseq.setUserCollection(getStringCase(sequence));\n\t\treturn seq;\n\t}\n\t\n\n\t/**\n\t * Assumes all compounds were uppercase\n\t * @see org.biojava3.core.sequence.io.ProteinSequenceCreator#getSequence(java.util.List)\n\t */\n\t@Override\n\tpublic AbstractSequence<AminoAcidCompound> getSequence(\n\t\t\tList<AminoAcidCompound> list) {\n\t\tAbstractSequence<AminoAcidCompound> seq =super.getSequence(list);\n\t\tCollection<Object> strCase = new ArrayList<Object>(seq.getLength());\n\t\tfor(int i=0;i<seq.getLength();i++) {\n\t\t\tstrCase.add(true);\n\t\t}\n\t\tseq.setUserCollection(strCase);\n\t\treturn seq;\n\t}\n\n\t/**\n\t * Returns a list of Booleans of the same length as the input, specifying\n\t * whether each character was uppercase or not.\n\t * @param str A string. Should not contain unicode supplemental characters.\n\t * @return a list of Booleans of the same length as the input, specifying\n\t * whether each character was uppercase or not.\n\t * This list contains only Booleans.\n\t */\n\tprivate static List<Object> getStringCase(String str) {\n\t\tList<Object> types = new ArrayList<Object>(str.length());\n\t\tfor(int i=0;i<str.length();i++) {\n\t\t\ttypes.add(Character.isUpperCase(str.charAt(i)));\n\t\t}\n\t\treturn types;\n\t}\n\t\n\tpublic static void main(String[] args) {\n\t\tCasePreservingProteinSequenceCreator creator = new CasePreservingProteinSequenceCreator(AminoAcidCompoundSet.getAminoAcidCompoundSet());\n\t\tAbstractSequence<AminoAcidCompound> seq = creator.getSequence(\"aaAA\",0);\n\t\tlogger.info(\"Sequence: {}\", seq.getSequenceAsString()); //\"AAAA\"\n\t\tlogger.info(\"User Collection: {}\", seq.getUserCollection()); //\"[false, false, true, true]\"\n\t}\n\t\n\t/**\n\t * Takes a {@link ProteinSequence} which was created by a \n\t * {@link CasePreservingProteinSequenceCreator}. Uses the case info\n\t * stored in the user collection to modify the output array. \n\t * \n\t * <p>Sets elements of the output array which correspond to lowercase letters\n\t * to null.\n\t * \n\t * @param seq Input sequence with case stored as the user collection\n\t * @param out \n\t */\n\tpublic static void setLowercaseToNull( ProteinSequence seq,\n\t\t\tObject[] out) {\n\t\t// should have been set by seq creator\n\t\tCollection<Object> userCollection = seq.getUserCollection();\n\t\tif(userCollection == null)\n\t\t\tthrow new IllegalArgumentException(\"Sequence doesn't contain valid case info\");\n\t\tif(userCollection.size() != out.length)\n\t\t\tthrow new IllegalArgumentException(\"Sequence length doesn't math output array length\");\n\t\t\n\t\tint pos = 0;\n\t\tfor(Object isAligned : userCollection) {\n\t\t\tassert(isAligned instanceof Boolean);\n\t\t\tif(!(Boolean)isAligned) {\n\t\t\t\tout[pos] = null;\n\t\t\t}\n\t\t\tpos++;\n\t\t}\n\t}\n}\n","changedPro":"package org.biojava3.core.sequence.io;\n\nimport java.util.ArrayList;\nimport java.util.Collection;\nimport java.util.List;\nimport java.util.Locale;\n\nimport org.biojava3.core.exceptions.CompoundNotFoundException;\nimport org.biojava3.core.sequence.ProteinSequence;\nimport org.biojava3.core.sequence.compound.AminoAcidCompound;\nimport org.biojava3.core.sequence.compound.AminoAcidCompoundSet;\nimport org.biojava3.core.sequence.template.AbstractSequence;\nimport org.biojava3.core.sequence.template.CompoundSet;\nimport org.biojava3.core.sequence.template.ProxySequenceReader;\nimport org.slf4j.Logger;\nimport org.slf4j.LoggerFactory;\n\n/**\n * A sequence creator which preserves the case of its input string in\n * the user collection of the returned ProteinSequence.\n * \n * <p>The user collection will be the same length as the resulting ProteinSequence.\n * Each object can be cast to a Boolean. If true, the corresponding position in\n * the input file was uppercase.\n * \n * <h3>Example</h3>\n * <code><pre>CasePreservingProteinSequenceCreator creator =\n *    new CasePreservingProteinSequenceCreator(AminoAcidCompoundSet.getAminoAcidCompoundSet());\n *AbstractSequence<AminoAcidCompound> seq = creator.getSequence(\"aaAA\",0);\n *System.out.println(seq.getSequenceAsString()); //\"AAAA\"\n *System.out.println(seq.getUserCollection()); //\"[false, false, true, true]\"\n *</code></pre>\n */\npublic class CasePreservingProteinSequenceCreator extends ProteinSequenceCreator {\n\n\tprivate final static Logger logger = LoggerFactory.getLogger(CasePreservingProteinSequenceCreator.class);\n\n\tpublic CasePreservingProteinSequenceCreator(\n\t\t\tCompoundSet<AminoAcidCompound> compoundSet) {\n\t\tsuper(compoundSet);\n\t}\n\n\t/**\n\t * \n\t * @see org.biojava3.core.sequence.io.ProteinSequenceCreator#getSequence(org.biojava3.core.sequence.template.ProxySequenceReader, long)\n\t */\n\t@Override\n\tpublic AbstractSequence<AminoAcidCompound> getSequence(\n\t\t\tProxySequenceReader<AminoAcidCompound> proxyLoader, long index) {\n\t\tAbstractSequence<AminoAcidCompound> seq = super.getSequence(proxyLoader, index);\n\t\tseq.setUserCollection(getStringCase(proxyLoader.getSequenceAsString()));\n\t\treturn seq;\n\t}\n\n\t/* (non-Javadoc)\n\t * @see org.biojava3.core.sequence.io.ProteinSequenceCreator#getSequence(java.lang.String, long)\n\t */\n\t@Override\n\tpublic AbstractSequence<AminoAcidCompound> getSequence(String sequence,\n\t\t\tlong index) throws CompoundNotFoundException {\n\t\tAbstractSequence<AminoAcidCompound> seq = super.getSequence(sequence.toUpperCase(Locale.ENGLISH), index);\n\t\tseq.setUserCollection(getStringCase(sequence));\n\t\treturn seq;\n\t}\n\t\n\n\t/**\n\t * Assumes all compounds were uppercase\n\t * @see org.biojava3.core.sequence.io.ProteinSequenceCreator#getSequence(java.util.List)\n\t */\n\t@Override\n\tpublic AbstractSequence<AminoAcidCompound> getSequence(\n\t\t\tList<AminoAcidCompound> list) {\n\t\tAbstractSequence<AminoAcidCompound> seq =super.getSequence(list);\n\t\tCollection<Object> strCase = new ArrayList<Object>(seq.getLength());\n\t\tfor(int i=0;i<seq.getLength();i++) {\n\t\t\tstrCase.add(true);\n\t\t}\n\t\tseq.setUserCollection(strCase);\n\t\treturn seq;\n\t}\n\n\t/**\n\t * Returns a list of Booleans of the same length as the input, specifying\n\t * whether each character was uppercase or not.\n\t * @param str A string. Should not contain unicode supplemental characters.\n\t * @return a list of Booleans of the same length as the input, specifying\n\t * whether each character was uppercase or not.\n\t * This list contains only Booleans.\n\t */\n\tprivate static List<Object> getStringCase(String str) {\n\t\tList<Object> types = new ArrayList<Object>(str.length());\n\t\tfor(int i=0;i<str.length();i++) {\n\t\t\ttypes.add(Character.isUpperCase(str.charAt(i)));\n\t\t}\n\t\treturn types;\n\t}\n\t\n\tpublic static void main(String[] args) throws Exception {\n\t\tCasePreservingProteinSequenceCreator creator = new CasePreservingProteinSequenceCreator(AminoAcidCompoundSet.getAminoAcidCompoundSet());\n\t\tAbstractSequence<AminoAcidCompound> seq = creator.getSequence(\"aaAA\",0);\n\t\tlogger.info(\"Sequence: {}\", seq.getSequenceAsString()); //\"AAAA\"\n\t\tlogger.info(\"User Collection: {}\", seq.getUserCollection()); //\"[false, false, true, true]\"\n\t}\n\t\n\t/**\n\t * Takes a {@link ProteinSequence} which was created by a \n\t * {@link CasePreservingProteinSequenceCreator}. Uses the case info\n\t * stored in the user collection to modify the output array. \n\t * \n\t * <p>Sets elements of the output array which correspond to lowercase letters\n\t * to null.\n\t * \n\t * @param seq Input sequence with case stored as the user collection\n\t * @param out \n\t */\n\tpublic static void setLowercaseToNull( ProteinSequence seq,\n\t\t\tObject[] out) {\n\t\t// should have been set by seq creator\n\t\tCollection<Object> userCollection = seq.getUserCollection();\n\t\tif(userCollection == null)\n\t\t\tthrow new IllegalArgumentException(\"Sequence doesn't contain valid case info\");\n\t\tif(userCollection.size() != out.length)\n\t\t\tthrow new IllegalArgumentException(\"Sequence length doesn't math output array length\");\n\t\t\n\t\tint pos = 0;\n\t\tfor(Object isAligned : userCollection) {\n\t\t\tassert(isAligned instanceof Boolean);\n\t\t\tif(!(Boolean)isAligned) {\n\t\t\t\tout[pos] = null;\n\t\t\t}\n\t\t\tpos++;\n\t\t}\n\t}\n}\n","originTest":"package org.biojava3.core.sequence.io;\n\nimport java.util.Collection;\n\nimport junit.framework.TestCase;\n\nimport org.biojava3.core.sequence.ProteinSequence;\nimport org.biojava3.core.sequence.compound.AminoAcidCompoundSet;\nimport org.biojava3.core.sequence.io.CasePreservingProteinSequenceCreator;\n\npublic class CasePreservingProteinSequenceCreatorTest extends TestCase {\n\n\tpublic void testConstructor() {\n\t\tCasePreservingProteinSequenceCreator creator = new CasePreservingProteinSequenceCreator(AminoAcidCompoundSet.getAminoAcidCompoundSet());\n\t\t\n\t\tString seq = \"aCDEfgHI-Jkl\";\n\t\tProteinSequence prot = (ProteinSequence) creator.getSequence(seq, 0);\n\t\tCollection<Object> uppercase = prot.getUserCollection();\n\t\t\n\t\t//test some assumptions. Hopefully work on non-english locals too?\n\t\tassertFalse(Character.isUpperCase('-'));\n\t\tassertFalse(Character.isUpperCase('.'));\n\t\t\n\t\tassertEquals(\"Lengths differ\",seq.length(),uppercase.size());\n\t\t\n\t\tint i=0;\n\t\tfor(Object obj : uppercase) {\n\t\t\tassertTrue(\"Not a Boolean\",obj instanceof Boolean);\n\t\t\tBoolean bool = (Boolean)obj;\n\t\t\tassertEquals(\"Doesn't match case of \"+seq.charAt(i),(Boolean)Character.isUpperCase(seq.charAt(i)),bool);\n\t\t\ti++;\n\t\t}\n\t}\n}\n","changedTest":"package org.biojava3.core.sequence.io;\n\nimport java.util.Collection;\n\nimport org.biojava3.core.exceptions.CompoundNotFoundException;\nimport org.biojava3.core.sequence.ProteinSequence;\nimport org.biojava3.core.sequence.compound.AminoAcidCompoundSet;\nimport org.biojava3.core.sequence.io.CasePreservingProteinSequenceCreator;\n\nimport org.junit.Test;\nimport static org.junit.Assert.*;\n\npublic class CasePreservingProteinSequenceCreatorTest {\n\n\t@Test\n\tpublic void testConstructor() throws CompoundNotFoundException {\n\t\tCasePreservingProteinSequenceCreator creator = new CasePreservingProteinSequenceCreator(AminoAcidCompoundSet.getAminoAcidCompoundSet());\n\t\t\n\t\tString seq = \"aCDEfgHI-Jkl\";\n\t\tProteinSequence prot = (ProteinSequence) creator.getSequence(seq, 0);\n\t\tCollection<Object> uppercase = prot.getUserCollection();\n\t\t\n\t\t//test some assumptions. Hopefully work on non-english locals too?\n\t\tassertFalse(Character.isUpperCase('-'));\n\t\tassertFalse(Character.isUpperCase('.'));\n\t\t\n\t\tassertEquals(\"Lengths differ\",seq.length(),uppercase.size());\n\t\t\n\t\tint i=0;\n\t\tfor(Object obj : uppercase) {\n\t\t\tassertTrue(\"Not a Boolean\",obj instanceof Boolean);\n\t\t\tBoolean bool = (Boolean)obj;\n\t\t\tassertEquals(\"Doesn't match case of \"+seq.charAt(i),(Boolean)Character.isUpperCase(seq.charAt(i)),bool);\n\t\t\ti++;\n\t\t}\n\t}\n}\n","commitMessage":"Fixing #193\n- also some improvement for #191: now a TranslationException will be\nthrown when compound not known\n- a few improvements for other issues: #111, #155, #185","test_commitMessage":"Fixing #193\n- also some improvement for #191: now a TranslationException will be\nthrown when compound not known\n- a few improvements for other issues: #111, #155, #185","allZero":false}